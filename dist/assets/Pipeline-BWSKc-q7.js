import{o as f,c as A,a as t,b as e,p as P,h as l,U as y,f as d,R as n,Y as F,_ as D,M as h,O as j,v as B,ac as M,ad as G,u as $,N as z,i as C,n as x,as as H,at as L,S,W as T,ab as O,r as k,a8 as U,D as E,B as R,ap as W,T as X,k as Y,m as _,a2 as w,X as V,au as J,F as N}from"./app-CqcLQhWc.js";import{_ as K}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-SEMuvBU0.js";import{d as Q}from"./vuedraggable.umd-BMc5FPIt.js";import{_ as I}from"./LoaderWrapper-CNYIpUw8.js";import"./LogoMain.vue_vue_type_script_setup_true_lang-BnGuLdGC.js";import"./useApi-o-nPpLEi-7nyp_4n4.js";const Z={class:"d-flex justify-space-between align-start mb-1"},ee={class:"d-flex align-center"},te={class:"text-subtitle-1 font-weight-bold text-truncate",style:{"max-width":"150px"}},ae={class:"text-caption text-medium-emphasis mb-2"},le={key:0,class:"text-caption text-medium-emphasis mb-2"},se={key:1,class:"text-caption text-medium-emphasis mb-2"},ie={class:"d-flex justify-space-between align-center mt-2"},ne={class:"text-subtitle-2 font-weight-bold text-primary"},de={class:"text-caption text-medium-emphasis"},oe={__name:"DealCard",props:{deal:{type:Object,required:!0}},setup(s){const p=s,r=c=>new Intl.NumberFormat("en-GH",{style:"currency",currency:p.deal.currency||"GHS"}).format(c),v=c=>c?new Date(c).toLocaleDateString():"N/A";return(c,i)=>(f(),A(x,{class:"mb-3 deal-card",elevation:"3"},{default:t(()=>[e(P,{class:"pa-3"},{default:t(()=>[l("div",Z,[l("div",ee,[e(y,{size:"small",color:"primary",class:"mr-2"},{default:t(()=>[...i[0]||(i[0]=[d("mdi-briefcase-variant-outline",-1)])]),_:1}),l("h4",te,n(s.deal.title),1)]),e(F,{size:"x-small",color:s.deal.stage?.color||"primary",variant:"flat"},{default:t(()=>[d(n(s.deal.probability)+"% ",1)]),_:1},8,["color"])]),l("div",ae,[e(D,{name:"custom-user-fill",class:"mr-1",style:{width:"14px",height:"14px","vertical-align":"middle"}}),d(" "+n(s.deal.contact?`${s.deal.contact.first_name} ${s.deal.contact.last_name}`:s.deal.contact_name||"No Contact"),1)]),s.deal.client?(f(),h("div",le,[e(D,{name:"custom-building",class:"mr-1",style:{width:"14px",height:"14px","vertical-align":"middle"}}),d(" "+n(s.deal.client.name),1)])):s.deal.client_name?(f(),h("div",se,[e(D,{name:"custom-building",class:"mr-1",style:{width:"14px",height:"14px","vertical-align":"middle"}}),d(" "+n(s.deal.client_name),1)])):j("",!0),l("div",ie,[l("div",ne,n(r(s.deal.value)),1),l("div",de,n(v(s.deal.expected_close_date)),1)])]),_:1}),e(B),e(M,{class:"pa-2"},{default:t(()=>[e(G),e($(z),{href:c.route("crm.deals.show",s.deal.id),class:"text-decoration-none"},{default:t(()=>[e(C,{variant:"text",size:"small",color:"primary"},{default:t(()=>[...i[1]||(i[1]=[d("View Details",-1)])]),_:1})]),_:1},8,["href"])]),_:1})]),_:1}))}},re=I(oe,[["__scopeId","data-v-7624e5a9"]]),ce={class:"pipeline-wrapper pa-4 position-relative"},ue={key:0,class:"updating-overlay d-flex align-center justify-center"},me={class:"pipeline-container d-flex overflow-x-auto pb-4"},fe={class:"text-subtitle-1 font-weight-bold"},pe={__name:"DealPipeline",props:{stages:{type:Array,required:!0},deals:{type:Array,required:!0}},setup(s){const p=s,r=k({});p.stages.forEach(i=>{r.value[i.id]=p.deals.filter(u=>u.deal_stage_id===i.id)});const v=k(!1),c=i=>{const{added:u,removed:g,moved:o}=i;if(u){const a=u.element,m=Object.keys(r.value).find(b=>r.value[b].includes(a));v.value=!0,U.put(window.route("crm.deals.updateStage",a.id),{deal_stage_id:m},{preserveScroll:!0,onFinish:()=>{v.value=!1},onSuccess:()=>{}})}};return(i,u)=>(f(),h("div",ce,[e(L,null,{default:t(()=>[v.value?(f(),h("div",ue,[e(F,{color:"primary",class:"px-4 py-2",elevation:"4"},{default:t(()=>[e(H,{indeterminate:"",size:"16",width:"2",class:"mr-2"}),u[0]||(u[0]=d(" Updating Pipeline... ",-1))]),_:1})])):j("",!0)]),_:1}),l("div",me,[(f(!0),h(S,null,T(s.stages,g=>(f(),h("div",{key:g.id,class:"stage-column mx-2",style:{"min-width":"300px",width:"300px"}},[e(x,{color:"grey-lighten-4",flat:"",class:"h-100"},{default:t(()=>[e(O,{class:"d-flex justify-space-between align-center py-3 px-4"},{default:t(()=>[l("span",fe,n(g.name),1)]),_:2},1024),e(B),e(P,{class:"pa-2 h-100"},{default:t(()=>[e($(Q),{modelValue:r.value[g.id],"onUpdate:modelValue":o=>r.value[g.id]=o,group:"deals","item-key":"id",class:"draggable-list",onChange:c,animation:200,"ghost-class":"ghost-card"},{item:t(({element:o})=>[e(re,{deal:o},null,8,["deal"])]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]))),128))])]))}},ve=I(pe,[["__scopeId","data-v-81a61a91"]]),ge={class:"d-flex gap-2"},xe={class:"d-flex align-center mb-1"},he={class:"d-flex align-center mb-1"},_e={class:"d-flex align-center mb-1"},ye={class:"d-flex align-center mb-1"},be={class:"text-h5 font-weight-bold counter-value"},we={class:"d-flex align-center mb-1"},Ve={class:"d-flex flex-column"},De={__name:"Pipeline",props:{stages:{type:Array,required:!0},deals:{type:Array,required:!0}},setup(s){const p=s,r=N(()=>p.deals.length),v=N(()=>p.deals.reduce((o,a)=>o+parseFloat(a.value),0)),c=o=>{const a=p.deals.filter(b=>b.deal_stage_id===o),m=a.reduce((b,q)=>b+parseFloat(q.value),0);return{count:a.length,value:m}},i=k(!1);E([r,v,()=>p.deals],()=>{i.value=!0,setTimeout(()=>{i.value=!1},500)},{deep:!0});const u=o=>new Intl.NumberFormat("en-GH",{style:"currency",currency:"GHS"}).format(o);let g;return R(()=>{g=setInterval(()=>{U.reload({only:["deals"],preserveScroll:!0})},3e4)}),W(()=>{g&&clearInterval(g)}),(o,a)=>(f(),h(S,null,[e($(X),{title:"Deal Pipeline"}),e(K,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(_,{cols:"12",class:"d-flex justify-space-between align-center mb-4"},{default:t(()=>[a[2]||(a[2]=l("div",null,[l("h2",{class:"text-h4 font-weight-bold"},"Deal Pipeline"),l("p",{class:"text-subtitle-1 text-medium-emphasis"},"Manage and track your sales opportunities")],-1)),l("div",ge,[e($(z),{href:o.route("crm.deals.index"),class:"text-decoration-none mr-2"},{default:t(()=>[e(C,{variant:"outlined",color:"primary"},{prepend:t(()=>[e(D,{name:"custom-list-outline",style:{width:"18px",height:"18px"}})]),default:t(()=>[a[0]||(a[0]=d(" List View ",-1))]),_:1})]),_:1},8,["href"]),e($(z),{href:o.route("crm.deals.create"),class:"text-decoration-none"},{default:t(()=>[e(C,{color:"primary"},{prepend:t(()=>[e(D,{name:"custom-plus",style:{width:"18px",height:"18px"}})]),default:t(()=>[a[1]||(a[1]=d(" New Deal ",-1))]),_:1})]),_:1},8,["href"])])]),_:1}),e(_,{cols:"12",md:"3"},{default:t(()=>[e(x,{class:"pa-4 metric-card",elevation:"2"},{default:t(()=>[l("div",xe,[e(w,{color:"blue-lighten-5",size:"32",class:"mr-2 icon-avatar"},{default:t(()=>[e(y,{color:"primary",size:"small"},{default:t(()=>[...a[3]||(a[3]=[d("mdi-briefcase-outline",-1)])]),_:1})]),_:1}),a[4]||(a[4]=l("span",{class:"text-caption font-weight-medium text-medium-emphasis"},"Total Deals",-1))]),l("div",{class:V(["text-h5 font-weight-bold counter-value",{"counter-value-updated":i.value}])},n(r.value),3)]),_:1})]),_:1}),e(_,{cols:"12",md:"3"},{default:t(()=>[e(x,{class:"pa-4 metric-card",elevation:"2"},{default:t(()=>[l("div",he,[e(w,{color:"green-lighten-5",size:"32",class:"mr-2 icon-avatar"},{default:t(()=>[e(y,{color:"success",size:"small"},{default:t(()=>[...a[5]||(a[5]=[d("mdi-currency-usd",-1)])]),_:1})]),_:1}),a[6]||(a[6]=l("span",{class:"text-caption font-weight-medium text-medium-emphasis"},"Pipeline Value",-1))]),l("div",{class:V(["text-h5 font-weight-bold text-success counter-value",{"counter-value-updated":i.value}])},n(u(v.value)),3)]),_:1})]),_:1}),e(_,{cols:"12",md:"3"},{default:t(()=>[e(x,{class:"pa-4 metric-card",elevation:"2"},{default:t(()=>[l("div",_e,[e(w,{color:"orange-lighten-5",size:"32",class:"mr-2 icon-avatar"},{default:t(()=>[e(y,{color:"warning",size:"small"},{default:t(()=>[...a[7]||(a[7]=[d("mdi-trending-up",-1)])]),_:1})]),_:1}),a[8]||(a[8]=l("span",{class:"text-caption font-weight-medium text-medium-emphasis"},"Avg. Deal Value",-1))]),l("div",{class:V(["text-h5 font-weight-bold counter-value",{"counter-value-updated":i.value}])},n(u(r.value?v.value/r.value:0)),3)]),_:1})]),_:1}),e(_,{cols:"12",md:"3"},{default:t(()=>[e(x,{class:"pa-4 metric-card",elevation:"2"},{default:t(()=>[l("div",ye,[e(w,{color:"purple-lighten-5",size:"32",class:"mr-2 icon-avatar"},{default:t(()=>[e(y,{color:"secondary",size:"small"},{default:t(()=>[...a[9]||(a[9]=[d("mdi-check-circle-outline",-1)])]),_:1})]),_:1}),a[10]||(a[10]=l("span",{class:"text-caption font-weight-medium text-medium-emphasis"},"Active Stages",-1))]),l("div",be,n(s.stages.length),1)]),_:1})]),_:1}),(f(!0),h(S,null,T(s.stages,m=>(f(),A(_,{key:m.id,cols:"12",sm:"6",md:"3",lg:"2"},{default:t(()=>[e(x,{class:"pa-3 metric-card stage-metric-card",elevation:"2"},{default:t(()=>[l("div",we,[e(w,{color:`${m.color}-lighten-5`,size:"28",class:"mr-2 icon-avatar"},{default:t(()=>[e(y,{color:m.color,size:"x-small"},{default:t(()=>[...a[11]||(a[11]=[d("mdi-circle-slice-8",-1)])]),_:1},8,["color"])]),_:2},1032,["color"]),l("span",{class:"text-caption font-weight-bold text-truncate",style:J([`color: rgb(var(--v-theme-${m.color}))`,{"max-width":"100px"}])},n(m.name),5)]),l("div",Ve,[l("div",{class:V(["text-subtitle-1 font-weight-bold counter-value",{"counter-value-updated":i.value}])},n(c(m.id).count)+" Deals ",3),l("div",{class:V(["text-caption font-weight-medium text-medium-emphasis counter-value",{"counter-value-updated":i.value}])},n(u(c(m.id).value)),3)])]),_:2},1024)]),_:2},1024))),128)),e(_,{cols:"12"},{default:t(()=>[e(x,{variant:"flat",class:"mt-2"},{default:t(()=>[e(ve,{stages:s.stages,deals:s.deals},null,8,["stages","deals"])]),_:1})]),_:1})]),_:1})]),_:1})],64))}},Ne=I(De,[["__scopeId","data-v-efa62b40"]]);export{Ne as default};
