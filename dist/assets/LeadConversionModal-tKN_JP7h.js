import{D as N,o as g,c as _,a as t,b as l,n as U,ab as z,h as n,i as b,v as x,p as B,aI as T,R as v,U as c,f as r,M as C,O as f,P as S,Y as w,Q as q,bh as P,g as k,$ as I,s as A,ax as E,ay as M,ac as O,ad as R,aa as j,r as V,a8 as F}from"./app-CqcLQhWc.js";import{_ as Q}from"./LoaderWrapper-CNYIpUw8.js";const Y={class:"text-body-1 font-weight-medium mb-1"},G={class:"text-body-2 text-grey-darken-1 mb-1"},H={key:0,class:"text-body-2 text-grey-darken-1"},J={class:"text-body-1"},K={key:0,class:"mt-4 pa-4 bg-blue-lighten-5 rounded"},W={__name:"LeadConversionModal",props:{show:{type:Boolean,required:!0},lead:{type:Object,required:!0},dealStages:{type:Array,default:()=>[]}},emits:["close","converted"],setup(d,{emit:D}){const u=d,y=D,m=V(!1),o=V(!1),a=V({create_client:!0,create_deal:!1,deal_title:"",deal_value:"",deal_stage_id:null}),$=()=>a.value.create_deal?!!(a.value.deal_title&&a.value.deal_value&&a.value.deal_value>0&&a.value.deal_stage_id):!0;N(()=>u.show,i=>{i&&(o.value=!1,a.value.deal_title=`${u.lead.company_name||u.lead.first_name+" "+u.lead.last_name} - New Deal`,u.dealStages.length>0&&(a.value.deal_stage_id=u.dealStages[0].id))});const L=async()=>{if(o.value=!0,!$())return;m.value=!0;const i={create_deal:a.value.create_deal};a.value.create_deal&&(i.deal_title=a.value.deal_title,i.deal_value=a.value.deal_value,i.deal_stage_id=a.value.deal_stage_id),F.post(route("crm.leads.convert",u.lead.id),i,{preserveScroll:!0,onSuccess:()=>{m.value=!1,y("converted"),y("close")},onError:()=>{m.value=!1}})};return(i,e)=>(g(),_(j,{"model-value":d.show,"onUpdate:modelValue":e[7]||(e[7]=s=>i.$emit("close")),"max-width":"700px",persistent:""},{default:t(()=>[l(U,null,{default:t(()=>[l(z,{class:"d-flex align-center justify-space-between pa-4 bg-primary"},{default:t(()=>[e[8]||(e[8]=n("span",{class:"text-h5 text-white"},"Convert Lead",-1)),l(b,{icon:"mdi-close",variant:"text",color:"white",onClick:e[0]||(e[0]=s=>i.$emit("close"))})]),_:1}),l(x),l(B,{class:"pa-6"},{default:t(()=>[l(T,{class:"pa-4 mb-6 bg-grey-lighten-4 rounded",elevation:"0"},{default:t(()=>[e[11]||(e[11]=n("div",{class:"text-subtitle-2 text-grey-darken-2 mb-2"},"Lead Summary",-1)),n("div",Y,v(d.lead.first_name)+" "+v(d.lead.last_name),1),n("div",G,[l(c,{size:"small",class:"mr-1"},{default:t(()=>[...e[9]||(e[9]=[r("mdi-email",-1)])]),_:1}),r(" "+v(d.lead.email||"No email"),1)]),d.lead.company_name?(g(),C("div",H,[l(c,{size:"small",class:"mr-1"},{default:t(()=>[...e[10]||(e[10]=[r("mdi-domain",-1)])]),_:1}),r(" "+v(d.lead.company_name),1)])):f("",!0)]),_:1}),n("div",null,[l(S,{modelValue:a.value.create_client,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.create_client=s),label:"Create Client",color:"primary",disabled:"","hide-details":"",class:"mb-4"},{label:t(()=>[n("span",J,[e[13]||(e[13]=r(" Create Client ",-1)),l(w,{size:"x-small",color:"error",class:"ml-2"},{default:t(()=>[...e[12]||(e[12]=[r("Required",-1)])]),_:1})])]),_:1},8,["modelValue"]),l(S,{modelValue:a.value.create_deal,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.create_deal=s),label:"Create Deal (Optional)",color:"primary","hide-details":"",class:"mb-4",disabled:!d.dealStages||d.dealStages.length===0},null,8,["modelValue","disabled"]),!d.dealStages||d.dealStages.length===0?(g(),_(q,{key:0,type:"warning",density:"compact",class:"mb-4"},{default:t(()=>[...e[14]||(e[14]=[r(" Cannot create deal: No pipeline stages available ",-1)])]),_:1})):f("",!0),l(P,null,{default:t(()=>[a.value.create_deal?(g(),C("div",K,[e[15]||(e[15]=n("div",{class:"text-subtitle-2 text-grey-darken-2 mb-4"},"Deal Details",-1)),l(k,{modelValue:a.value.deal_title,"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.deal_title=s),label:"Deal Title *",variant:"outlined",density:"comfortable",class:"mb-4",error:a.value.create_deal&&!a.value.deal_title&&o.value,"error-messages":a.value.create_deal&&!a.value.deal_title&&o.value?["Deal title is required when creating a deal"]:[]},null,8,["modelValue","error","error-messages"]),l(k,{modelValue:a.value.deal_value,"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.deal_value=s),label:"Deal Value *",type:"number",variant:"outlined",density:"comfortable",prefix:"$",class:"mb-4",error:a.value.create_deal&&(!a.value.deal_value||a.value.deal_value<=0)&&o.value,"error-messages":a.value.create_deal&&(!a.value.deal_value||a.value.deal_value<=0)&&o.value?["Deal value must be greater than 0"]:[]},null,8,["modelValue","error","error-messages"]),l(I,{modelValue:a.value.deal_stage_id,"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.deal_stage_id=s),items:d.dealStages,"item-title":"name","item-value":"id",label:"Pipeline Stage *",variant:"outlined",density:"comfortable",error:a.value.create_deal&&!a.value.deal_stage_id&&o.value,"error-messages":a.value.create_deal&&!a.value.deal_stage_id&&o.value?["Pipeline stage is required when creating a deal"]:[],disabled:!d.dealStages||d.dealStages.length===0},{item:t(({props:s,item:p})=>[l(A,E(M(s)),{prepend:t(()=>[l(w,{color:p.raw.color,size:"x-small",class:"mr-2"},{default:t(()=>[r(v(p.raw.probability)+"% ",1)]),_:2},1032,["color"])]),_:2},1040)]),_:1},8,["modelValue","items","error","error-messages","disabled"])])):f("",!0)]),_:1})])]),_:1}),l(x),l(O,{class:"pa-4"},{default:t(()=>[l(R),l(b,{variant:"text",color:"grey-darken-1",onClick:e[6]||(e[6]=s=>i.$emit("close")),disabled:m.value},{default:t(()=>[...e[16]||(e[16]=[r(" Cancel ",-1)])]),_:1},8,["disabled"]),l(b,{color:"primary",variant:"elevated",onClick:L,loading:m.value,disabled:m.value},{default:t(()=>[l(c,{left:"",class:"mr-2"},{default:t(()=>[...e[17]||(e[17]=[r("mdi-swap-horizontal",-1)])]),_:1}),e[18]||(e[18]=r(" Convert Lead ",-1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},h=Q(W,[["__scopeId","data-v-4a60d64f"]]);export{h as L};
