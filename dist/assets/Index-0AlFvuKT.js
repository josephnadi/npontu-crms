import{r as C,D as z,o as c,M as b,b as l,u as v,T as q,a as e,k as L,m as r,h as s,N as h,i as g,f as n,_ as S,a8 as p,n as T,p as G,g as H,ar as K,$ as N,a4 as M,S as j,W as R,R as i,Y as W,am as Y,c as I,aj as Z,q as J,s as y,Z as x,U as V,O as P,a7 as Q,a9 as X}from"./app-CqcLQhWc.js";import{_ as ee}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-SEMuvBU0.js";import{l as te}from"./lodash-CdjocJhF.js";import{_ as le}from"./LoaderWrapper-CNYIpUw8.js";import"./LogoMain.vue_vue_type_script_setup_true_lang-BnGuLdGC.js";import"./useApi-o-nPpLEi-7nyp_4n4.js";const ae={class:"d-flex gap-2"},se={class:"font-weight-medium"},oe={class:"text-caption"},ne={key:1},re={class:"text-right"},ie={class:"text-right"},ue={key:0},de={class:"pa-4 d-flex justify-center"},me={__name:"Index",props:{deals:{type:Object,required:!0},filters:Object,stages:Array},setup(u){const _=u,d=C(_.filters?.search||""),m=C(_.filters?.stage_id||""),f=C(_.filters?.status||""),D=C(!1),w=()=>{D.value=!0,p.get(route("crm.deals.index"),{search:d.value,stage_id:m.value,status:f.value},{preserveState:!0,replace:!0,preserveScroll:!0,onFinish:()=>D.value=!1})},$=()=>{d.value="",m.value="",f.value="",w()},A=o=>new Intl.NumberFormat("en-GH",{style:"currency",currency:"GHS"}).format(o),F=o=>o?new Date(o).toLocaleDateString():"N/A",U=o=>{confirm("Are you sure you want to delete this deal?")&&p.delete(window.route("crm.deals.destroy",o))},B=o=>{confirm("Convert this won deal to a Project?")&&p.post(route("crm.deals.convert",o))},E=o=>{confirm("Convert this deal back to a Lead?")&&p.post(route("crm.deals.convert-to-lead",o))},O=o=>{confirm("Create a support ticket for this deal?")&&p.post(route("crm.deals.convert-to-ticket",o))};return z([d,m,f],te.debounce(()=>{w()},500)),(o,t)=>(c(),b(j,null,[l(v(q),{title:"Deals List"}),l(ee,null,{default:e(()=>[l(L,null,{default:e(()=>[l(r,{cols:"12",class:"d-flex justify-space-between align-center"},{default:e(()=>[t[9]||(t[9]=s("div",null,[s("h2",{class:"text-h4 font-weight-bold"},"Deals List"),s("p",{class:"text-subtitle-1 text-medium-emphasis"},"Overview of all active and closed deals")],-1)),s("div",ae,[l(v(h),{href:o.route("crm.deals.pipeline"),class:"text-decoration-none mr-2"},{default:e(()=>[l(g,{variant:"outlined",color:"primary"},{prepend:e(()=>[l(S,{name:"custom-row-vertical",style:{width:"18px",height:"18px"}})]),default:e(()=>[t[6]||(t[6]=n(" Pipeline View ",-1))]),_:1})]),_:1},8,["href"]),l(g,{variant:"outlined",color:"secondary",onClick:t[0]||(t[0]=a=>v(p).get(o.route("crm.deals.export"),{search:d.value,stage_id:m.value,status:f.value}))},{prepend:e(()=>[l(S,{name:"custom-download",style:{width:"18px",height:"18px"}})]),default:e(()=>[t[7]||(t[7]=n(" Export CSV ",-1))]),_:1}),l(v(h),{href:o.route("crm.deals.create"),class:"text-decoration-none"},{default:e(()=>[l(g,{color:"primary"},{prepend:e(()=>[l(S,{name:"custom-plus",style:{width:"18px",height:"18px"}})]),default:e(()=>[t[8]||(t[8]=n(" New Deal ",-1))]),_:1})]),_:1},8,["href"])])]),_:1}),l(r,{cols:"12"},{default:e(()=>[l(T,{class:"mb-4"},{default:e(()=>[l(G,null,{default:e(()=>[l(L,null,{default:e(()=>[l(r,{cols:"12",md:"4"},{default:e(()=>[l(H,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=a=>d.value=a),label:"Search deals...","prepend-inner-icon":"mdi-magnify","hide-details":"",variant:"outlined",density:"comfortable",onKeyup:K(w,["enter"])},null,8,["modelValue"])]),_:1}),l(r,{cols:"12",md:"3"},{default:e(()=>[l(N,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=a=>m.value=a),items:[{title:"All Stages",value:""},...u.stages.map(a=>({title:a.name,value:a.id}))],label:"Stage","hide-details":"",variant:"outlined",density:"comfortable"},null,8,["modelValue","items"])]),_:1}),l(r,{cols:"12",md:"3"},{default:e(()=>[l(N,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=a=>f.value=a),items:[{title:"All Statuses",value:""},{title:"Open",value:"open"},{title:"Won",value:"won"},{title:"Lost",value:"lost"}],label:"Status","hide-details":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(r,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:e(()=>[l(g,{color:"primary",block:"",flat:"",onClick:w},{default:e(()=>[...t[10]||(t[10]=[n("Filter",-1)])]),_:1}),l(g,{variant:"outlined",block:"",onClick:$},{default:e(()=>[...t[11]||(t[11]=[n("Clear",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(r,{cols:"12"},{default:e(()=>[l(T,{variant:"flat"},{default:e(()=>[l(M,{hover:""},{default:e(()=>[t[25]||(t[25]=s("thead",null,[s("tr",null,[s("th",{class:"text-left"},"Title"),s("th",{class:"text-left"},"Stage"),s("th",{class:"text-left"},"Value"),s("th",{class:"text-left"},"Probability"),s("th",{class:"text-left"},"Contact"),s("th",{class:"text-left"},"Expected Close"),s("th",{class:"text-right"},"Actions")])],-1)),s("tbody",null,[(c(!0),b(j,null,R(u.deals.data,a=>(c(),b("tr",{key:a.id},[s("td",se,i(a.title),1),s("td",null,[l(W,{size:"small",color:a.stage?.color||"primary",variant:"tonal"},{default:e(()=>[n(i(a.stage?.name||"Unknown"),1)]),_:2},1032,["color"])]),s("td",null,i(A(a.value)),1),s("td",null,[l(Y,{"model-value":a.probability,color:a.stage?.color||"primary",height:"8",rounded:""},null,8,["model-value","color"]),s("span",oe,i(a.probability)+"%",1)]),s("td",null,[a.contact?(c(),I(v(h),{key:0,href:o.route("crm.contacts.show",a.contact.id),class:"text-primary text-decoration-none font-weight-medium"},{default:e(()=>[n(i(a.contact.first_name)+" "+i(a.contact.last_name),1)]),_:2},1032,["href"])):(c(),b("span",ne,i(a.contact_name||"N/A"),1))]),s("td",null,i(F(a.expected_close_date)),1),s("td",re,[s("td",ie,[l(Z,null,{activator:e(({props:k})=>[l(g,Q({icon:"mdi-pencil",size:"small"},{ref_for:!0},k),null,16)]),default:e(()=>[l(J,null,{default:e(()=>[l(y,{to:o.route("crm.deals.show",a.id)},{prepend:e(()=>[l(V,null,{default:e(()=>[...t[12]||(t[12]=[n("mdi-eye",-1)])]),_:1})]),default:e(()=>[l(x,null,{default:e(()=>[...t[13]||(t[13]=[n("View Details",-1)])]),_:1})]),_:1},8,["to"]),l(y,{to:o.route("crm.deals.edit",a.id)},{prepend:e(()=>[l(V,null,{default:e(()=>[...t[14]||(t[14]=[n("mdi-pencil",-1)])]),_:1})]),default:e(()=>[l(x,null,{default:e(()=>[...t[15]||(t[15]=[n("Edit Deal",-1)])]),_:1})]),_:1},8,["to"]),a.status!=="won"?(c(),I(y,{key:0,onClick:k=>B(a.id)},{prepend:e(()=>[l(V,null,{default:e(()=>[...t[16]||(t[16]=[n("mdi-briefcase-check-outline",-1)])]),_:1})]),default:e(()=>[l(x,null,{default:e(()=>[...t[17]||(t[17]=[n("Convert to Project",-1)])]),_:1})]),_:1},8,["onClick"])):P("",!0),l(y,{onClick:k=>E(a.id)},{prepend:e(()=>[l(V,null,{default:e(()=>[...t[18]||(t[18]=[n("mdi-account-convert-outline",-1)])]),_:1})]),default:e(()=>[l(x,null,{default:e(()=>[...t[19]||(t[19]=[n("Convert to Lead",-1)])]),_:1})]),_:1},8,["onClick"]),l(y,{onClick:k=>O(a.id)},{prepend:e(()=>[l(V,null,{default:e(()=>[...t[20]||(t[20]=[n("mdi-ticket-outline",-1)])]),_:1})]),default:e(()=>[l(x,null,{default:e(()=>[...t[21]||(t[21]=[n("Convert to Ticket",-1)])]),_:1})]),_:1},8,["onClick"]),l(y,{onClick:k=>U(a.id)},{prepend:e(()=>[l(V,null,{default:e(()=>[...t[22]||(t[22]=[n("mdi-delete",-1)])]),_:1})]),default:e(()=>[l(x,null,{default:e(()=>[...t[23]||(t[23]=[n("Delete Deal",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)])])]))),128)),u.deals.data.length===0?(c(),b("tr",ue,[...t[24]||(t[24]=[s("td",{colspan:"7",class:"text-center py-8 text-medium-emphasis"}," No deals found. Start by creating a new deal! ",-1)])])):P("",!0)])]),_:1})]),_:1})]),_:1}),l(r,{cols:"12"},{default:e(()=>[s("div",de,[l(X,{modelValue:u.deals.current_page,"onUpdate:modelValue":[t[4]||(t[4]=a=>u.deals.current_page=a),t[5]||(t[5]=a=>v(p).get(o.route("crm.deals.index"),{page:a,search:d.value,stage_id:m.value,status:f.value},{preserveState:!0}))],length:u.deals.last_page,size:"small","active-color":"primary"},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1})],64))}},xe=le(me,[["__scopeId","data-v-74b70711"]]);export{xe as default};
