import{o as r,M as S,b as t,u as b,T as te,a as l,k as W,m as g,h as s,N as j,i as o,_ as U,n as f,R as d,aj as le,q as G,S as H,W as ae,c,s as N,Z as ne,f as n,Y as O,a7 as ie,U as v,O as T,Q as z,v as R,af as se,ag as Q,ah as oe,ai as Y,a8 as p,aa as D,ab as $,p as E,ac as B,ad as P,r as m}from"./app-CqcLQhWc.js";import{_ as de}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-SEMuvBU0.js";import{A as ue,_ as re,a as me}from"./EngagementForm-CftqFFTl.js";import{_ as fe}from"./ActivityForm-C_6vI7lP.js";import"./LoaderWrapper-CNYIpUw8.js";import"./LogoMain.vue_vue_type_script_setup_true_lang-BnGuLdGC.js";import"./useApi-o-nPpLEi-7nyp_4n4.js";const ve={class:"mb-6 d-flex align-center"},ge={class:"text-h5 font-weight-bold mb-1"},ce={class:"d-flex align-center gap-2"},pe={class:"text-h5 font-weight-bold text-primary"},xe={class:"text-body-1"},we={class:"mb-4"},be={class:"d-flex align-center"},ye={key:1,class:"text-body-1"},Ce={class:"d-flex align-center"},ke={key:1,class:"text-body-1"},Ve={class:"mb-4"},Te={class:"d-flex align-center"},De={class:"text-body-1"},$e={class:"d-flex justify-space-between align-center mb-4"},Ee={class:"d-flex gap-2"},Pe={__name:"Show",props:{deal:{type:Object,required:!0},stages:{type:Array,required:!0}},setup(a){const x=a,L=m("activities"),w=m(!1),Z=u=>{p.put(window.route("crm.deals.updateStage",x.deal.id),{deal_stage_id:u},{preserveScroll:!0})},M=u=>new Intl.NumberFormat("en-GH",{style:"currency",currency:"GHS"}).format(u),J=u=>u?new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",K=()=>{confirm("Are you sure you want to delete this deal?")&&p.delete(window.route("crm.deals.destroy",x.deal.id))},y=m(!1),C=m(!1),k=m(!1),A=m(!1),q=m(!1),F=m(!1),V=m(!1),I=m(!1),X=()=>{A.value=!0,p.post(window.route("crm.deals.convert",x.deal.id),{},{onSuccess:()=>{y.value=!1,A.value=!1},onError:()=>{A.value=!1}})},h=()=>{I.value=!0,p.post(window.route("crm.deals.convert-to-engagement",x.deal.id),{},{onFinish:()=>{I.value=!1,V.value=!1}})},_=()=>{q.value=!0,p.post(window.route("crm.deals.convert-to-lead",x.deal.id),{},{onFinish:()=>{q.value=!1,C.value=!1}})},ee=()=>{F.value=!0,p.post(window.route("crm.deals.convert-to-ticket",x.deal.id),{},{onFinish:()=>{F.value=!1,k.value=!1}})};return(u,e)=>(r(),S(H,null,[t(b(te),{title:`Deal: ${a.deal.title}`},null,8,["title"]),t(de,null,{default:l(()=>[t(W,{justify:"center"},{default:l(()=>[t(g,{cols:"12",md:"8"},{default:l(()=>[s("div",ve,[t(b(j),{href:u.route("crm.deals.index"),class:"mr-4"},{default:l(()=>[t(o,{icon:"",variant:"text"},{default:l(()=>[t(U,{name:"custom-chevron-left",style:{width:"20px",height:"20px"}})]),_:1})]),_:1},8,["href"]),e[20]||(e[20]=s("h2",{class:"text-h4 font-weight-bold"},"Deal Details",-1))]),t(f,{class:"pa-6 mb-6"},{default:l(()=>[t(W,null,{default:l(()=>[t(g,{cols:"12",class:"d-flex justify-space-between align-start"},{default:l(()=>[s("div",null,[s("h3",ge,d(a.deal.title),1),s("div",ce,[t(le,null,{activator:l(({props:i})=>[t(O,ie(i,{color:a.deal.stage?.color||"primary",variant:"tonal",size:"small",class:"cursor-pointer"}),{default:l(()=>[n(d(a.deal.stage?.name)+" ("+d(a.deal.probability)+"%) ",1),t(v,{end:"",size:"x-small"},{default:l(()=>[...e[21]||(e[21]=[n("mdi-chevron-down",-1)])]),_:1})]),_:1},16,["color"])]),default:l(()=>[t(G,{density:"compact"},{default:l(()=>[(r(!0),S(H,null,ae(a.stages,i=>(r(),c(N,{key:i.id,value:i.id,onClick:Le=>Z(i.id),active:i.id===a.deal.deal_stage_id},{default:l(()=>[t(ne,null,{default:l(()=>[n(d(i.name),1)]),_:2},1024)]),_:2},1032,["value","onClick","active"]))),128))]),_:1})]),_:1})])]),s("div",pe,d(M(a.deal.value)),1)]),_:1}),a.deal.description?(r(),c(g,{key:0,cols:"12"},{default:l(()=>[e[22]||(e[22]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Description",-1)),s("p",xe,d(a.deal.description),1)]),_:1})):T("",!0),a.deal.status==="lost"&&a.deal.lost_reason?(r(),c(g,{key:1,cols:"12"},{default:l(()=>[t(z,{type:"error",variant:"tonal",title:"Deal Lost",text:a.deal.lost_reason,class:"mt-2"},null,8,["text"])]),_:1})):T("",!0),t(g,{cols:"12"},{default:l(()=>[t(R,{class:"my-4"})]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[s("div",we,[e[23]||(e[23]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Contact Person",-1)),s("div",be,[t(U,{name:"custom-user-fill",class:"mr-2",style:{width:"18px",height:"18px"}}),a.deal.contact?(r(),c(b(j),{key:0,href:u.route("crm.contacts.show",a.deal.contact.id),class:"text-primary text-decoration-none font-weight-medium"},{default:l(()=>[n(d(a.deal.contact.first_name)+" "+d(a.deal.contact.last_name),1)]),_:1},8,["href"])):(r(),S("span",ye,d(a.deal.contact_name||"Not assigned"),1))])]),s("div",null,[e[24]||(e[24]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Client/Company",-1)),s("div",Ce,[t(U,{name:"custom-building",class:"mr-2",style:{width:"18px",height:"18px"}}),a.deal.client?(r(),c(b(j),{key:0,href:u.route("crm.clients.show",a.deal.client.id),class:"text-primary text-decoration-none font-weight-medium"},{default:l(()=>[n(d(a.deal.client.name),1)]),_:1},8,["href"])):(r(),S("span",ke,d(a.deal.client_name||"Not assigned"),1))])])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[s("div",Ve,[e[25]||(e[25]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Expected Close Date",-1)),s("div",Te,[t(U,{name:"custom-calendar",class:"mr-2",style:{width:"18px",height:"18px"}}),s("span",De,d(J(a.deal.expected_close_date)),1)])]),s("div",null,[e[26]||(e[26]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Status",-1)),t(O,{color:a.deal.status==="open"?"info":a.deal.status==="won"?"success":"error",variant:"flat",size:"small",class:"text-uppercase"},{default:l(()=>[n(d(a.deal.status||"open"),1)]),_:1},8,["color"])])]),_:1}),t(g,{cols:"12",class:"mt-6 d-flex justify-end gap-2"},{default:l(()=>[t(o,{color:"error",variant:"text",class:"mr-auto",onClick:K,title:"Delete Deal"},{default:l(()=>[t(v,null,{default:l(()=>[...e[27]||(e[27]=[n("mdi-delete",-1)])]),_:1})]),_:1}),a.deal.status==="open"?(r(),c(o,{key:0,color:"success",variant:"outlined",onClick:e[0]||(e[0]=i=>y.value=!0),title:"Convert to Project"},{default:l(()=>[t(v,null,{default:l(()=>[...e[28]||(e[28]=[n("mdi-rocket-launch-outline",-1)])]),_:1})]),_:1})):T("",!0),a.deal.status==="open"?(r(),c(o,{key:1,color:"warning",variant:"outlined",onClick:e[1]||(e[1]=i=>C.value=!0),title:"Convert to Lead"},{default:l(()=>[t(v,null,{default:l(()=>[...e[29]||(e[29]=[n("mdi-account-convert-outline",-1)])]),_:1})]),_:1})):T("",!0),t(o,{color:"info",variant:"outlined",onClick:e[2]||(e[2]=i=>k.value=!0),title:"Convert to Ticket"},{default:l(()=>[t(v,null,{default:l(()=>[...e[30]||(e[30]=[n("mdi-ticket-outline",-1)])]),_:1})]),_:1}),t(o,{color:"purple",variant:"outlined",onClick:e[3]||(e[3]=i=>V.value=!0),title:"Convert to Engagement"},{default:l(()=>[t(v,null,{default:l(()=>[...e[31]||(e[31]=[n("mdi-handshake-outline",-1)])]),_:1})]),_:1}),t(b(j),{href:u.route("crm.deals.edit",a.deal.id),class:"text-decoration-none"},{default:l(()=>[t(o,{variant:"outlined",color:"secondary",title:"Edit Deal"},{default:l(()=>[t(v,null,{default:l(()=>[...e[32]||(e[32]=[n("mdi-pencil",-1)])]),_:1})]),_:1})]),_:1},8,["href"]),t(o,{color:"info",onClick:e[4]||(e[4]=i=>w.value=!0),title:"Log Engagement"},{default:l(()=>[t(v,null,{default:l(()=>[...e[33]||(e[33]=[n("mdi-calendar-plus",-1)])]),_:1})]),_:1}),t(o,{color:"primary",href:u.route("crm.deals.pipeline"),title:"Update Stage"},{default:l(()=>[t(v,null,{default:l(()=>[...e[34]||(e[34]=[n("mdi-view-column",-1)])]),_:1})]),_:1},8,["href"])]),_:1})]),_:1})]),_:1}),t(se,{modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=i=>L.value=i),color:"primary",class:"mb-4"},{default:l(()=>[t(Q,{value:"activities"},{default:l(()=>[...e[35]||(e[35]=[n("Activities",-1)])]),_:1}),t(Q,{value:"engagements"},{default:l(()=>[...e[36]||(e[36]=[n("Engagements",-1)])]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:L.value,"onUpdate:modelValue":e[8]||(e[8]=i=>L.value=i)},{default:l(()=>[t(Y,{value:"activities"},{default:l(()=>[t(f,{class:"pa-6 mb-6"},{default:l(()=>[e[37]||(e[37]=s("div",{class:"d-flex justify-space-between align-center mb-4"},[s("h3",{class:"text-h5 font-weight-bold"},"Log Activity")],-1)),t(fe,{"activityable-type":"App\\Models\\Deal","activityable-id":a.deal.id},null,8,["activityable-id"])]),_:1}),t(f,{class:"pa-6"},{default:l(()=>[e[38]||(e[38]=s("div",{class:"mb-6"},[s("h3",{class:"text-h5 font-weight-bold"},"Activity Timeline")],-1)),t(ue,{activities:a.deal.activities||[]},null,8,["activities"])]),_:1})]),_:1}),t(Y,{value:"engagements"},{default:l(()=>[t(f,{class:"pa-6"},{default:l(()=>[s("div",$e,[e[41]||(e[41]=s("h3",{class:"text-h5 font-weight-bold"},"Engagement Timeline",-1)),s("div",Ee,[t(o,{color:"warning",size:"small",variant:"flat","prepend-icon":"mdi-star-plus-outline",onClick:e[6]||(e[6]=i=>w.value=!0)},{default:l(()=>[...e[39]||(e[39]=[n(" Log Engagement ",-1)])]),_:1}),t(o,{color:"secondary",size:"small",variant:"text","prepend-icon":"mdi-star-outline",onClick:e[7]||(e[7]=i=>b(p).get(u.route("crm.engagements.index")))},{default:l(()=>[...e[40]||(e[40]=[n(" View All ",-1)])]),_:1})])]),t(R,{class:"mb-4"}),t(re,{engagements:a.deal.engagements||[]},null,8,["engagements"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(D,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=i=>w.value=i),"max-width":"700px"},{default:l(()=>[t(f,null,{default:l(()=>[t($,{class:"pa-4 bg-warning text-white d-flex justify-space-between align-center"},{default:l(()=>[s("span",null,"Log Engagement for "+d(a.deal.title),1),t(o,{icon:"mdi-close",variant:"text",size:"small",onClick:e[9]||(e[9]=i=>w.value=!1)})]),_:1}),t(E,{class:"pa-4 pt-6"},{default:l(()=>[t(me,{"engageable-type":"App\\Models\\Deal","engageable-id":a.deal.id,onSuccess:e[10]||(e[10]=i=>w.value=!1)},null,8,["engageable-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=i=>y.value=i),"max-width":"500px"},{default:l(()=>[t(f,null,{default:l(()=>[t($,{class:"pa-4 bg-success text-white"},{default:l(()=>[...e[42]||(e[42]=[n(" Convert Deal to Project? ",-1)])]),_:1}),t(E,{class:"pa-4 pt-6"},{default:l(()=>[e[43]||(e[43]=s("p",{class:"text-body-1 mb-4"},[n(" This will mark the deal as "),s("strong",null,"Won"),n(" and create a new project with the following details: ")],-1)),t(G,{density:"compact"},{default:l(()=>[t(N,{"prepend-icon":"mdi-format-title",title:"Project Name",subtitle:a.deal.title},null,8,["subtitle"]),t(N,{"prepend-icon":"mdi-currency-usd",title:"Budget",subtitle:M(a.deal.value)},null,8,["subtitle"]),a.deal.client?(r(),c(N,{key:0,"prepend-icon":"mdi-office-building",title:"Client",subtitle:a.deal.client.name},null,8,["subtitle"])):T("",!0)]),_:1}),e[44]||(e[44]=s("p",{class:"text-caption text-medium-emphasis mt-4"}," All activities and engagements associated with this deal will be migrated to the new project. ",-1))]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[t(P),t(o,{variant:"text",onClick:e[12]||(e[12]=i=>y.value=!1)},{default:l(()=>[...e[45]||(e[45]=[n("Cancel",-1)])]),_:1}),t(o,{color:"success",variant:"elevated",loading:A.value,onClick:X},{default:l(()=>[...e[46]||(e[46]=[n(" Confirm & Convert ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:C.value,"onUpdate:modelValue":e[15]||(e[15]=i=>C.value=i),"max-width":"500px"},{default:l(()=>[t(f,null,{default:l(()=>[t($,{class:"pa-4 bg-warning text-white"},{default:l(()=>[...e[47]||(e[47]=[n(" Convert Deal back to Lead? ",-1)])]),_:1}),t(E,{class:"pa-4 pt-6"},{default:l(()=>[e[49]||(e[49]=s("p",{class:"text-body-1 mb-4"}," This will create a new Lead based on this deal's information. ",-1)),t(z,{type:"info",variant:"tonal",class:"mb-4"},{default:l(()=>[...e[48]||(e[48]=[n(" The deal will remain in the system, but a new lead will be created for further qualification. ",-1)])]),_:1})]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[t(P),t(o,{variant:"text",onClick:e[14]||(e[14]=i=>C.value=!1)},{default:l(()=>[...e[50]||(e[50]=[n("Cancel",-1)])]),_:1}),t(o,{color:"warning",variant:"elevated",loading:q.value,onClick:_},{default:l(()=>[...e[51]||(e[51]=[n(" Confirm & Convert ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:k.value,"onUpdate:modelValue":e[17]||(e[17]=i=>k.value=i),"max-width":"500px"},{default:l(()=>[t(f,null,{default:l(()=>[t($,{class:"pa-4 bg-info text-white"},{default:l(()=>[...e[52]||(e[52]=[n(" Create Support Ticket from Deal? ",-1)])]),_:1}),t(E,{class:"pa-4 pt-6"},{default:l(()=>[e[54]||(e[54]=s("p",{class:"text-body-1 mb-4"}," This will create a support ticket related to this deal. ",-1)),t(z,{type:"info",variant:"tonal",class:"mb-4"},{default:l(()=>[...e[53]||(e[53]=[n(" Useful for tracking technical issues or support requests during the sales process. ",-1)])]),_:1})]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[t(P),t(o,{variant:"text",onClick:e[16]||(e[16]=i=>k.value=!1)},{default:l(()=>[...e[55]||(e[55]=[n("Cancel",-1)])]),_:1}),t(o,{color:"info",variant:"elevated",loading:F.value,onClick:ee},{default:l(()=>[...e[56]||(e[56]=[n(" Confirm & Create ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:V.value,"onUpdate:modelValue":e[19]||(e[19]=i=>V.value=i),"max-width":"500px"},{default:l(()=>[t(f,null,{default:l(()=>[t($,{class:"pa-4 bg-purple text-white"},{default:l(()=>[...e[57]||(e[57]=[n(" Convert Deal to Engagement? ",-1)])]),_:1}),t(E,{class:"pa-4 pt-6"},{default:l(()=>[e[59]||(e[59]=s("p",{class:"text-body-1 mb-4"}," This will create a new Engagement based on this deal's information. ",-1)),t(z,{type:"info",variant:"tonal",class:"mb-4"},{default:l(()=>[...e[58]||(e[58]=[n(" An engagement will be created to schedule a follow-up or meeting related to this deal. ",-1)])]),_:1})]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[t(P),t(o,{variant:"text",onClick:e[18]||(e[18]=i=>V.value=!1)},{default:l(()=>[...e[60]||(e[60]=[n("Cancel",-1)])]),_:1}),t(o,{color:"purple",variant:"elevated",loading:I.value,onClick:h},{default:l(()=>[...e[61]||(e[61]=[n(" Confirm & Create ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})],64))}};export{Pe as default};
